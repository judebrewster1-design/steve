<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>üêÜ Merle Cam - Login</title>
<style>
* {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
}

body {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  background: linear-gradient(135deg, #1a1a1a 0%, #0a0a0a 100%);
  color: #f6e0b2;
  min-height: 100vh;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 20px;
}

.login-container {
  background: #2a1a0a;
  padding: 40px;
  border-radius: 20px;
  border: 3px solid #d4a23c;
  box-shadow: 0 0 50px rgba(212, 162, 60, 0.4);
  max-width: 450px;
  width: 100%;
}

.logo {
  text-align: center;
  margin-bottom: 30px;
}

.logo-icon {
  font-size: 80px;
}

h1 {
  font-size: 32px;
  color: #d4a23c;
  margin-bottom: 10px;
}

.subtitle {
  color: #c4a872;
  font-size: 14px;
  margin-bottom: 30px;
}

.tabs {
  display: flex;
  gap: 10px;
  margin-bottom: 25px;
}

.tab {
  flex: 1;
  padding: 12px;
  background: #1a1a1a;
  border: 2px solid #5e4528;
  border-radius: 8px;
  cursor: pointer;
  text-align: center;
  font-weight: bold;
  transition: all 0.3s;
}

.tab.active {
  background: linear-gradient(135deg, #d4a23c, #b88a28);
  color: #1a1a1a;
  border-color: #d4a23c;
}

.tab:hover {
  border-color: #d4a23c;
}

.form-group {
  margin-bottom: 20px;
}

label {
  display: block;
  margin-bottom: 8px;
  color: #d4a23c;
  font-weight: bold;
  font-size: 14px;
}

input {
  width: 100%;
  padding: 15px;
  background: #1a1a1a;
  border: 2px solid #5e4528;
  border-radius: 8px;
  color: #f6e0b2;
  font-size: 16px;
  font-family: inherit;
}

input:focus {
  outline: none;
  border-color: #d4a23c;
}

.btn {
  width: 100%;
  padding: 15px;
  background: linear-gradient(135deg, #d4a23c, #b88a28);
  border: none;
  border-radius: 8px;
  color: #1a1a1a;
  font-weight: bold;
  font-size: 16px;
  cursor: pointer;
  transition: all 0.3s;
  margin-bottom: 15px;
}

.btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 5px 20px rgba(212, 162, 60, 0.5);
}

.btn:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

.btn-guest {
  background: rgba(255, 255, 255, 0.1);
  color: #f6e0b2;
}

.btn-guest:hover {
  background: rgba(255, 255, 255, 0.15);
}

.error {
  background: rgba(248, 113, 113, 0.2);
  color: #f87171;
  padding: 12px;
  border-radius: 8px;
  margin-bottom: 20px;
  border-left: 3px solid #f87171;
  font-size: 14px;
}

.success {
  background: rgba(74, 222, 128, 0.2);
  color: #4ade80;
  padding: 12px;
  border-radius: 8px;
  margin-bottom: 20px;
  border-left: 3px solid #4ade80;
  font-size: 14px;
}

.info-box {
  background: rgba(212, 162, 60, 0.1);
  border: 1px solid #d4a23c;
  padding: 15px;
  border-radius: 8px;
  font-size: 13px;
  color: #c4a872;
  margin-top: 20px;
}

.loading {
  display: inline-block;
  width: 20px;
  height: 20px;
  border: 3px solid rgba(255, 255, 255, 0.3);
  border-radius: 50%;
  border-top-color: #1a1a1a;
  animation: spin 1s linear infinite;
}

@keyframes spin {
  to { transform: rotate(360deg); }
}

.hidden {
  display: none;
}
</style>
</head>
<body>

<div class="login-container">
  <div class="logo">
    <div class="logo-icon">üêÜ</div>
    <h1>Merle Cam</h1>
    <p class="subtitle">Advanced Surveillance System</p>
  </div>

  <div class="tabs">
    <div class="tab active" onclick="switchTab('login')">Login</div>
    <div class="tab" onclick="switchTab('register')">Sign Up</div>
  </div>

  <div id="errorMsg" class="error hidden"></div>
  <div id="successMsg" class="success hidden"></div>

  <!-- Login Form -->
  <form id="loginForm" onsubmit="handleLogin(event)">
    <div class="form-group">
      <label>Username</label>
      <input type="text" id="loginUsername" placeholder="Enter username" required>
    </div>
    <div class="form-group">
      <label>Password</label>
      <input type="password" id="loginPassword" placeholder="Enter password" required>
    </div>
    <button type="submit" class="btn" id="loginBtn">üîì Login</button>
    <button type="button" class="btn btn-guest" onclick="continueAsGuest()">üëÅÔ∏è Continue as Guest</button>
  </form>

  <!-- Register Form -->
  <form id="registerForm" class="hidden" onsubmit="handleRegister(event)">
    <div class="form-group">
      <label>Username</label>
      <input type="text" id="regUsername" placeholder="Choose a username" required>
    </div>
    <div class="form-group">
      <label>Password</label>
      <input type="password" id="regPassword" placeholder="Create password (min 6 chars)" required minlength="6">
    </div>
    <div class="form-group">
      <label>Confirm Password</label>
      <input type="password" id="regPasswordConfirm" placeholder="Confirm password" required>
    </div>
    <button type="submit" class="btn" id="registerBtn">‚ú® Create Account</button>
    <button type="button" class="btn btn-guest" onclick="continueAsGuest()">üëÅÔ∏è Continue as Guest</button>
  </form>

  <div class="info-box">
    <strong>‚ÑπÔ∏è About Accounts:</strong><br>
    ‚Ä¢ Multiple people can use the same username<br>
    ‚Ä¢ Your password makes your account unique<br>
    ‚Ä¢ <strong>Guest mode:</strong> View stream & chat, but can't type<br>
    ‚Ä¢ Blue checkmark ‚úì = Verified by admin
  </div>
</div>

<script>
const API_URL = 'https://williams-meters-within-likelihood.trycloudflare.com';

function switchTab(tab) {
  const tabs = document.querySelectorAll('.tab');
  tabs.forEach(t => t.classList.remove('active'));
  
  if (tab === 'login') {
    tabs[0].classList.add('active');
    document.getElementById('loginForm').classList.remove('hidden');
    document.getElementById('registerForm').classList.add('hidden');
  } else {
    tabs[1].classList.add('active');
    document.getElementById('loginForm').classList.add('hidden');
    document.getElementById('registerForm').classList.remove('hidden');
  }
  
  hideMessages();
}

function showError(msg) {
  const errorDiv = document.getElementById('errorMsg');
  errorDiv.textContent = msg;
  errorDiv.classList.remove('hidden');
  document.getElementById('successMsg').classList.add('hidden');
}

function showSuccess(msg) {
  const successDiv = document.getElementById('successMsg');
  successDiv.textContent = msg;
  successDiv.classList.remove('hidden');
  document.getElementById('errorMsg').classList.add('hidden');
}

function hideMessages() {
  document.getElementById('errorMsg').classList.add('hidden');
  document.getElementById('successMsg').classList.add('hidden');
}

async function handleLogin(e) {
  e.preventDefault();
  hideMessages();
  
  const username = document.getElementById('loginUsername').value.trim();
  const password = document.getElementById('loginPassword').value;
  const btn = document.getElementById('loginBtn');
  
  btn.disabled = true;
  btn.innerHTML = '<div class="loading"></div>';
  
  try {
    const response = await fetch(`${API_URL}/auth/login`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ username, password })
    });
    
    const result = await response.json();
    
    if (result.success) {
      localStorage.setItem('session_token', result.session_token);
      localStorage.setItem('username', result.username);
      localStorage.setItem('verified', result.verified);
      localStorage.setItem('guest_mode', 'false');
      
      showSuccess('Login successful! Redirecting...');
      setTimeout(() => window.location.href = 'dashboard.html', 1000);
    } else {
      showError(result.error || 'Login failed');
    }
  } catch (error) {
    showError('Connection error. Please try again.');
  } finally {
    btn.disabled = false;
    btn.innerHTML = 'üîì Login';
  }
}

async function handleRegister(e) {
  e.preventDefault();
  hideMessages();
  
  const username = document.getElementById('regUsername').value.trim();
  const password = document.getElementById('regPassword').value;
  const passwordConfirm = document.getElementById('regPasswordConfirm').value;
  const btn = document.getElementById('registerBtn');
  
  if (password !== passwordConfirm) {
    showError('Passwords do not match!');
    return;
  }
  
  btn.disabled = true;
  btn.innerHTML = '<div class="loading"></div>';
  
  try {
    const response = await fetch(`${API_URL}/auth/register`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ username, password })
    });
    
    const result = await response.json();
    
    if (result.success) {
      localStorage.setItem('session_token', result.session_token);
      localStorage.setItem('username', result.username);
      localStorage.setItem('verified', result.verified);
      localStorage.setItem('guest_mode', 'false');
      
      showSuccess('Account created! Redirecting...');
      setTimeout(() => window.location.href = 'dashboard.html', 1000);
    } else {
      showError(result.error || 'Registration failed');
    }
  } catch (error) {
    showError('Connection error. Please try again.');
  } finally {
    btn.disabled = false;
    btn.innerHTML = '‚ú® Create Account';
  }
}

function continueAsGuest() {
  localStorage.setItem('guest_mode', 'true');
  localStorage.setItem('username', 'Guest');
  localStorage.removeItem('session_token');
  localStorage.removeItem('verified');
  
  window.location.href = 'dashboard.html';
}

// Check if already logged in
window.onload = () => {
  const token = localStorage.getItem('session_token');
  if (token) {
    window.location.href = 'dashboard.html';
  }
};
</script>

</body>
</html>
