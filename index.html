
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üé∞ Judeceno Casino</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        .animate-spin { animation: spin 1s linear infinite; }
        .animate-bounce { animation: bounce 1s infinite; }
        @keyframes bounce {
            0%, 100% { transform: translateY(-25%); animation-timing-function: cubic-bezier(0.8, 0, 1, 1); }
            50% { transform: translateY(0); animation-timing-function: cubic-bezier(0, 0, 0.2, 1); }
        }
        .animate-pulse { animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite; }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: .5; }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-gray-900 via-purple-900 to-gray-900 text-white min-h-screen">
    <div id="app"></div>

    <script>
        const API_URL = 'http://localhost:5000';
        let currentUser = null;
        let currentGame = null;
        let isDemo = false;

        // State for each game
        let gameStates = {
            blackjack: { bet: 100, gameState: null, loading: false },
            poker: { bet: 100, result: null, loading: false },
            mines: { bet: 100, mineCount: 5, gameActive: false, revealed: [], multiplier: 1.0, gameOver: false, loading: false },
            coinflip: { bet: 100, choice: 'heads', result: null, loading: false, flipping: false },
            roulette: { bet: 100, betType: 'red', result: null, loading: false, spinning: false },
            towers: { bet: 100, difficulty: 'easy', gameActive: false, currentRow: 0, revealed: [], gameOver: false, loading: false, multiplier: 1.0 },
            plinko: { bet: 100, risk: 'medium', result: null, loading: false, dropping: false },
            hilo: { bet: 100, gameActive: false, currentCard: null, nextCard: null, multiplier: 1.0, gameOver: false, loading: false }
        };

        const games = [
            { id: 'blackjack', name: 'Blackjack', icon: 'üÉè', color: 'from-red-500 to-pink-600' },
            { id: 'poker', name: 'Poker', icon: '‚ô†Ô∏è', color: 'from-blue-500 to-cyan-600' },
            { id: 'mines', name: 'Mines', icon: 'üí£', color: 'from-orange-500 to-red-600' },
            { id: 'towers', name: 'Towers', icon: 'üè¢', color: 'from-purple-500 to-pink-600' },
            { id: 'plinko', name: 'Plinko', icon: 'üéØ', color: 'from-yellow-500 to-orange-600' },
            { id: 'roulette', name: 'Roulette', icon: 'üé°', color: 'from-green-500 to-teal-600' },
            { id: 'hilo', name: 'Hi-Lo', icon: 'üìä', color: 'from-indigo-500 to-blue-600' },
            { id: 'coinflip', name: 'Coin Flip', icon: 'ü™ô', color: 'from-gray-500 to-slate-600' }
        ];

        async function handleAuth(isLogin) {
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            const errorDiv = document.getElementById('error');

            if (!username || !password) {
                errorDiv.textContent = 'Please enter username and password';
                errorDiv.classList.remove('hidden');
                return;
            }

            try {
                const endpoint = isLogin ? '/login' : '/register';
                const res = await fetch(`${API_URL}${endpoint}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ username, password })
                });

                const data = await res.json();
                if (res.ok) {
                    currentUser = data;
                    renderMainApp();
                } else {
                    errorDiv.textContent = data.error;
                    errorDiv.classList.remove('hidden');
                }
            } catch (err) {
                errorDiv.textContent = 'Connection failed. Is the server running?';
                errorDiv.classList.remove('hidden');
            }
        }

        function renderAuthScreen() {
            document.getElementById('app').innerHTML = `
                <div class="min-h-screen flex items-center justify-center p-4">
                    <div class="bg-gray-800 rounded-lg border border-gray-700 w-full max-w-md p-8">
                        <div class="text-center mb-8">
                            <h1 class="text-4xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-purple-400 to-pink-600 mb-2">
                                üé∞ Judeceno Casino
                            </h1>
                            <p class="text-gray-400">Your Premium Gaming Destination</p>
                        </div>

                        <div id="error" class="hidden bg-red-500/20 border border-red-500 rounded-lg p-3 mb-4 text-red-300 text-sm"></div>

                        <div class="space-y-4">
                            <input type="text" id="username" placeholder="Username" 
                                class="w-full px-4 py-3 bg-gray-900 border border-gray-700 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:border-purple-500">
                            <input type="password" id="password" placeholder="Password"
                                class="w-full px-4 py-3 bg-gray-900 border border-gray-700 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:border-purple-500">
                            <button onclick="handleAuth(true)" class="w-full px-4 py-3 bg-purple-600 hover:bg-purple-700 rounded-lg font-semibold transition-all">
                                Login
                            </button>
                            <button onclick="handleAuth(false)" class="w-full px-4 py-3 bg-gray-700 hover:bg-gray-600 rounded-lg font-semibold transition-all">
                                Register
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderMainApp() {
            const balance = isDemo ? currentUser.freeBalance : currentUser.balance;
            document.getElementById('app').innerHTML = `
                <!-- Header -->
                <div class="bg-gray-800/50 backdrop-blur-sm border-b border-gray-700 sticky top-0 z-50">
                    <div class="max-w-7xl mx-auto px-4 py-4">
                        <div class="flex items-center justify-between">
                            <h1 class="text-2xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-purple-400 to-pink-600">
                                üé∞ Judeceno
                            </h1>
                            
                            <div class="flex items-center gap-4">
                                <div class="flex items-center gap-2 bg-gray-900 px-4 py-2 rounded-lg">
                                    <span class="text-sm text-gray-400">Mode:</span>
                                    <button onclick="toggleDemo()" class="px-3 py-1 rounded text-sm font-semibold ${isDemo ? 'bg-yellow-600' : 'bg-green-600'}">
                                        ${isDemo ? 'üéÅ Demo' : 'üí∞ Real'}
                                    </button>
                                </div>
                                
                                <div class="bg-gray-900 px-4 py-2 rounded-lg">
                                    <div class="flex items-center gap-2">
                                        <span class="text-green-400">üíµ</span>
                                        <span class="font-bold">$${(balance / 100).toFixed(2)}</span>
                                    </div>
                                </div>

                                <button onclick="showBugReport()" class="p-2 bg-gray-900 rounded-lg hover:bg-gray-700 transition-colors" title="Report Bug">
                                    üêõ
                                </button>

                                <button onclick="logout()" class="p-2 bg-gray-900 rounded-lg hover:bg-red-700 transition-colors" title="Logout">
                                    üö™
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Main Content -->
                <div class="max-w-7xl mx-auto px-4 py-8">
                    <div id="game-container">
                        ${currentGame ? renderGame(currentGame) : renderGameSelection()}
                    </div>
                </div>

                <!-- Bug Report Modal -->
                <div id="bug-modal" class="hidden fixed inset-0 bg-black/70 flex items-center justify-center p-4 z-50">
                    <div class="bg-gray-800 rounded-lg border border-gray-700 w-full max-w-md p-6">
                        <h3 class="text-2xl font-bold mb-4">üêõ Report a Bug</h3>
                        <div class="space-y-4">
                            <select id="bug-game" class="w-full px-4 py-2 bg-gray-900 border border-gray-700 rounded-lg text-white">
                                <option value="">Select Game</option>
                                ${games.map(g => `<option value="${g.id}">${g.name}</option>`).join('')}
                            </select>
                            <textarea id="bug-description" placeholder="Describe the bug..." 
                                class="w-full px-4 py-2 bg-gray-900 border border-gray-700 rounded-lg text-white h-32 resize-none"></textarea>
                            <div class="flex gap-2">
                                <button onclick="submitBugReport()" class="flex-1 px-4 py-2 bg-purple-600 hover:bg-purple-700 rounded-lg font-semibold">
                                    Submit Report
                                </button>
                                <button onclick="closeBugReport()" class="flex-1 px-4 py-2 bg-gray-700 hover:bg-gray-600 rounded-lg font-semibold">
                                    Cancel
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderGameSelection() {
            return `
                <div class="text-center mb-12">
                    <h2 class="text-4xl font-bold mb-2">Welcome, ${currentUser.username}! üéâ</h2>
                    <p class="text-gray-400">Choose your game and let's win big!</p>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                    ${games.map(game => `
                        <button onclick="selectGame('${game.id}')" 
                            class="group relative overflow-hidden rounded-xl bg-gradient-to-br from-gray-800 to-gray-900 p-6 transition-all hover:scale-105 hover:shadow-2xl hover:shadow-purple-500/20">
                            <div class="absolute inset-0 bg-gradient-to-br ${game.color} opacity-0 group-hover:opacity-10 transition-opacity"></div>
                            <div class="relative">
                                <div class="text-5xl mb-3">${game.icon}</div>
                                <h3 class="text-xl font-bold mb-1">${game.name}</h3>
                                <p class="text-gray-400 text-sm">Click to play</p>
                            </div>
                        </button>
                    `).join('')}
                </div>
            `;
        }

        function renderGame(gameId) {
            const gameRenderers = {
                blackjack: renderBlackjack,
                poker: renderPoker,
                mines: renderMines,
                coinflip: renderCoinFlip,
                roulette: renderRoulette,
                towers: renderTowers,
                plinko: renderPlinko,
                hilo: renderHiLo
            };

            return `
                <button onclick="backToGames()" class="mb-4 px-4 py-2 bg-gray-800 hover:bg-gray-700 rounded-lg transition-colors">
                    ‚Üê Back to Games
                </button>
                ${gameRenderers[gameId]()}
            `;
        }

        function renderCard(card) {
            if (!card) return '<div class="w-20 h-28 bg-purple-600 rounded-lg border-2 border-white/20"></div>';
            const suitSymbols = { hearts: '‚ô•', diamonds: '‚ô¶', clubs: '‚ô£', spades: '‚ô†' };
            const colorClass = card.color === 'red' ? 'text-red-600' : 'text-black';
            return `
                <div class="w-20 h-28 bg-white rounded-lg border-2 flex flex-col items-center justify-center ${colorClass}">
                    <div class="text-2xl font-bold">${card.value}</div>
                    <div class="text-3xl">${suitSymbols[card.suit]}</div>
                </div>
            `;
        }

        function renderBlackjack() {
            const state = gameStates.blackjack;
            const gs = state.gameState;

            if (!gs || gs.result) {
                return `
                    <div class="bg-gray-800 rounded-lg border border-gray-700 p-6">
                        <h2 class="text-3xl font-bold mb-6 text-center">üÉè Blackjack</h2>
                        ${gs?.result ? `
                            <div class="p-4 rounded-lg text-center text-xl font-bold mb-4 ${gs.result.win > 0 ? 'bg-green-500/20 text-green-300' : 'bg-red-500/20 text-red-300'}">
                                ${gs.result.message} ${gs.result.win > 0 ? `- Won $${(gs.result.win / 100).toFixed(2)}!` : ''}
                            </div>
                        ` : ''}
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm text-gray-400 mb-2">Bet Amount</label>
                                <input type="number" id="bj-bet" value="${state.bet}" min="100" step="100"
                                    class="w-full px-4 py-2 bg-gray-900 border border-gray-700 rounded-lg text-white">
                            </div>
                            <button onclick="dealBlackjack()" class="w-full px-4 py-3 bg-purple-600 hover:bg-purple-700 rounded-lg font-semibold">
                                Deal Cards - $${(state.bet / 100).toFixed(2)}
                            </button>
                        </div>
                    </div>
                `;
            }

            return `
                <div class="bg-gray-800 rounded-lg border border-gray-700 p-6">
                    <h2 class="text-3xl font-bold mb-6 text-center">üÉè Blackjack</h2>
                    <div class="space-y-6">
                        <div>
                            <h3 class="text-lg font-semibold mb-3 text-center">Dealer's Hand</h3>
                            <div class="flex gap-2 justify-center">
                                ${gs.dealerHand.map(card => renderCard(card)).join('')}
                            </div>
                            ${gs.dealerScore ? `<div class="text-center mt-2 text-xl font-bold">Score: ${gs.dealerScore}</div>` : ''}
                        </div>
                        <div>
                            <h3 class="text-lg font-semibold mb-3 text-center">Your Hand</h3>
                            <div class="flex gap-2 justify-center">
                                ${gs.playerHand.map(card => renderCard(card)).join('')}
                            </div>
                            <div class="text-center mt-2 text-xl font-bold">Score: ${gs.playerScore}</div>
                        </div>
                        <div class="flex gap-2">
                            <button onclick="hitBlackjack()" class="flex-1 px-4 py-2 bg-purple-600 hover:bg-purple-700 rounded-lg font-semibold">
                                Hit
                            </button>
                            <button onclick="standBlackjack()" class="flex-1 px-4 py-2 bg-gray-700 hover:bg-gray-600 rounded-lg font-semibold">
                                Stand
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderPoker() {
            const state = gameStates.poker;
            const result = state.result;

            return `
                <div class="bg-gray-800 rounded-lg border border-gray-700 p-6">
                    <h2 class="text-3xl font-bold mb-6 text-center">‚ô†Ô∏è Three Card Poker</h2>
                    <div class="space-y-4">
                        ${result ? `
                            <div class="p-4 rounded-lg text-center text-xl font-bold mb-4 ${result.result.win > 0 ? 'bg-green-500/20 text-green-300' : 'bg-red-500/20 text-red-300'}">
                                ${result.result.message} ${result.result.win > 0 ? `- Won $${(result.result.win / 100).toFixed(2)}!` : ''}
                            </div>
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <h3 class="text-lg font-semibold mb-3 text-center">Your Hand</h3>
                                    <div class="flex gap-2 justify-center">
                                        ${result.playerHand.map(card => renderCard(card)).join('')}
                                    </div>
                                </div>
                                <div>
                                    <h3 class="text-lg font-semibold mb-3 text-center">Dealer's Hand</h3>
                                    <div class="flex gap-2 justify-center">
                                        ${result.dealerHand.map(card => renderCard(card)).join('')}
                                    </div>
                                </div>
                            </div>
                        ` : ''}
                        <div>
                            <label class="block text-sm text-gray-400 mb-2">Bet Amount</label>
                            <input type="number" id="poker-bet" value="${state.bet}" min="100" step="100"
                                class="w-full px-4 py-2 bg-gray-900 border border-gray-700 rounded-lg text-white">
                        </div>
                        <button onclick="playPoker()" class="w-full px-4 py-3 bg-purple-600 hover:bg-purple-700 rounded-lg font-semibold">
                            ${result ? 'Play Again' : 'Play'} - $${(state.bet / 100).toFixed(2)}
                        </button>
                    </div>
                </div>
            `;
        }

        function renderMines() {
            const state = gameStates.mines;

            if (!state.gameActive) {
                return `
                    <div class="bg-gray-800 rounded-lg border border-gray-700 p-6">
                        <h2 class="text-3xl font-bold mb-6 text-center">üí£ Mines</h2>
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm text-gray-400 mb-2">Bet Amount</label>
                                <input type="number" id="mines-bet" value="${state.bet}" min="100" step="100"
                                    class="w-full px-4 py-2 bg-gray-900 border border-gray-700 rounded-lg text-white">
                            </div>
                            <div>
                                <label class="block text-sm text-gray-400 mb-2">Number of Mines (1-24)</label>
                                <input type="number" id="mines-count" value="${state.mineCount}" min="1" max="24"
                                    class="w-full px-4 py-2 bg-gray-900 border border-gray-700 rounded-lg text-white">
                            </div>
                            <button onclick="startMines()" class="w-full px-4 py-3 bg-purple-600 hover:bg-purple-700 rounded-lg font-semibold">
                                Start Game - $${(state.bet / 100).toFixed(2)}
                            </button>
                        </div>
                    </div>
                `;
            }

            return `
                <div class="bg-gray-800 rounded-lg border border-gray-700 p-6">
                    <h2 class="text-3xl font-bold mb-6 text-center">üí£ Mines</h2>
                    <div class="space-y-4">
                        <div class="flex justify-between items-center p-4 bg-gray-900 rounded-lg">
                            <div>
                                <div class="text-sm text-gray-400">Multiplier</div>
                                <div class="text-2xl font-bold text-green-400">${state.multiplier.toFixed(2)}x</div>
                            </div>
                            <div>
                                <div class="text-sm text-gray-400">Potential Win</div>
                                <div class="text-2xl font-bold">$${((state.bet * state.multiplier) / 100).toFixed(2)}</div>
                            </div>
                        </div>
                        <div class="grid grid-cols-5 gap-2">
                            ${Array(25).fill(0).map((_, i) => `
                                <button onclick="revealMine(${i})" ${state.revealed.includes(i) || state.gameOver ? 'disabled' : ''}
                                    class="aspect-square rounded-lg text-2xl font-bold transition-all ${
                                        state.revealed.includes(i) ? 'bg-green-500 text-white' : 'bg-gray-700 hover:bg-gray-600'
                                    } disabled:opacity-50">
                                    ${state.revealed.includes(i) ? 'üíé' : '?'}
                                </button>
                            `).join('')}
                        </div>
                        ${!state.gameOver && state.revealed.length > 0 ? `
                            <button onclick="cashoutMines()" class="w-full px-4 py-3 bg-green-600 hover:bg-green-700 rounded-lg font-semibold">
                                Cashout $${((state.bet * state.multiplier) / 100).toFixed(2)}
                            </button>
                        ` : ''}
                        ${state.gameOver ? `
                            <button onclick="resetMines()" class="w-full px-4 py-3 bg-purple-600 hover:bg-purple-700 rounded-lg font-semibold">
                                New Game
                            </button>
                        ` : ''}
                    </div>
                </div>
            `;
        }

        function renderCoinFlip() {
            const state = gameStates.coinflip;
            return `
                <div class="bg-gray-800 rounded-lg border border-gray-700 p-6">
                    <h2 class="text-3xl font-bold mb-6 text-center">ü™ô Coin Flip</h2>
                    <div class="space-y-6">
                        ${state.result && !state.flipping ? `
                            <div class="p-4 rounded-lg text-center text-xl font-bold ${state.result.isWin ? 'bg-green-500/20 text-green-300' : 'bg-red-500/20 text-red-300'}">
                                ${state.result.outcome.toUpperCase()} - ${state.result.isWin ? `Won $${(state.result.winAmount / 100).toFixed(2)}!` : 'Better luck next time!'}
                            </div>
                        ` : ''}
                        <div class="flex justify-center">
                            <div class="w-32 h-32 rounded-full flex items-center justify-center text-6xl ${state.flipping ? 'animate-spin' : ''} ${
                                state.result ? (state.result.outcome === 'heads' ? 'bg-yellow-500' : 'bg-gray-400') : 'bg-purple-600'
                            }">
                                ${state.flipping ? 'ü™ô' : state.result ? (state.result.outcome === 'heads' ? 'üëë' : '‚ö°') : 'ü™ô'}
                            </div>
                        </div>
                        <div class="flex gap-4">
                            <button onclick="selectCoinSide('heads')" class="flex-1 py-4 rounded-lg font-bold transition-all ${state.choice === 'heads' ? 'bg-yellow-600' : 'bg-gray-700 hover:bg-gray-600'}">
                                üëë Heads
                            </button>
                            <button onclick="selectCoinSide('tails')" class="flex-1 py-4 rounded-lg font-bold transition-all ${state.choice === 'tails' ? 'bg-gray-500' : 'bg-gray-700 hover:bg-gray-600'}">
                                ‚ö° Tails
                            </button>
                        </div>
                        <div>
                            <label class="block text-sm text-gray-400 mb-2">Bet Amount</label>
                            <input type="number" id="coin-bet" value="${state.bet}" min="100" step="100"
                                class="w-full px-4 py-2 bg-gray-900 border border-gray-700 rounded-lg text-white">
                        </div>
                        <button onclick="flipCoin()" ${state.loading ? 'disabled' : ''} class="w-full px-4 py-3 bg-purple-600 hover:bg-purple-700 rounded-lg font-semibold disabled:opacity-50">
                            Flip Coin - $${(state.bet / 100).toFixed(2)}
                        </button>
                    </div>
                </div>
            `;
        }

        function renderRoulette() {
            const state = gameStates.roulette;
            const getNumberColor = (num) => {
                if (num === 0) return 'green';
                const reds = [1,3,5,7,9,12,14,16,18,19,21,23,25,27,30,32,34,36];
                return reds.includes(num) ? 'red' : 'black';
            };

            return `
                <div class="bg-gray-800 rounded-lg border border-gray-700 p-6">
                    <h2 class="text-3xl font-bold mb-6 text-center">üé° Roulette</h2>
                    <div class="space-y-6">
                        ${state.result && !state.spinning ? `
                            <div class="p-6 rounded-lg text-center ${state.result.isWin ? 'bg-green-500/20' : 'bg-red-500/20'}">
                                <div class="text-4xl font-bold mb-2">${state.result.outcome}</div>
                                <div class="text-lg font-semibold ${state.result.isWin ? 'text-green-300' : 'text-red-300'}">
                                    ${state.result.isWin ? `Won $${(state.result.winAmount / 100).toFixed(2)}!` : 'Try again!'}
                                </div>
                            </div>
                        ` : ''}
                        <div class="flex justify-center">
                            <div class="w-40 h-40 rounded-full flex items-center justify-center text-6xl border-4 ${
                                state.spinning ? 'animate-spin border-purple-500' : 'border-gray-600'
                            } ${
                                state.result ? (
                                    getNumberColor(state.result.outcome) === 'green' ? 'bg-green-600' :
                                    getNumberColor(state.result.outcome) === 'red' ? 'bg-red-600' : 'bg-gray-900'
                                ) : 'bg-purple-900'
                            }">
                                ${state.spinning ? 'üé∞' : state.result ? state.result.outcome : 'üé°'}
                            </div>
                        </div>
                        <div class="grid grid-cols-3 gap-2">
                            <button onclick="selectBetType('red')" class="py-3 rounded-lg font-bold ${state.betType === 'red' ? 'bg-red-600' : 'bg-gray-700 hover:bg-red-700'}">
                                üî¥ Red (2x)
                            </button>
                            <button onclick="selectBetType('black')" class="py-3 rounded-lg font-bold ${state.betType === 'black' ? 'bg-gray-900 border-2 border-white' : 'bg-gray-700 hover:bg-gray-900'}">
                                ‚ö´ Black (2x)
                            </button>
                            <button onclick="selectBetType('green')" class="py-3 rounded-lg font-bold ${state.betType === 'green' ? 'bg-green-600' : 'bg-gray-700 hover:bg-green-700'}">
                                üü¢ Green (36x)
                            </button>
                            <button onclick="selectBetType('even')" class="py-3 rounded-lg font-bold ${state.betType === 'even' ? 'bg-blue-600' : 'bg-gray-700 hover:bg-blue-700'}">
                                Even (2x)
                            </button>
                            <button onclick="selectBetType('odd')" class="py-3 rounded-lg font-bold ${state.betType === 'odd' ? 'bg-purple-600' : 'bg-gray-700 hover:bg-purple-700'}">
                                Odd (2x)
                            </button>
                        </div>
                        <div>
                            <label class="block text-sm text-gray-400 mb-2">Bet Amount</label>
                            <input type="number" id="roulette-bet" value="${state.bet}" min="100" step="100"
                                class="w-full px-4 py-2 bg-gray-900 border border-gray-700 rounded-lg text-white">
                        </div>
                        <button onclick="spinRoulette()" ${state.loading ? 'disabled' : ''} class="w-full px-4 py-3 bg-purple-600 hover:bg-purple-700 rounded-lg font-semibold disabled:opacity-50">
                            Spin - ${(state.bet / 100).toFixed(2)}
                        </button>
                    </div>
                </div>
            `;
        }

        function renderTowers() {
            const state = gameStates.towers;

            if (!state.gameActive) {
                return `
                    <div class="bg-gray-800 rounded-lg border border-gray-700 p-6">
                        <h2 class="text-3xl font-bold mb-6 text-center">üè¢ Towers</h2>
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm text-gray-400 mb-2">Difficulty</label>
                                <div class="flex gap-2">
                                    <button onclick="selectDifficulty('easy')" class="flex-1 py-2 rounded-lg font-bold ${state.difficulty === 'easy' ? 'bg-green-600' : 'bg-gray-700 hover:bg-gray-600'}">
                                        Easy (1 bomb)
                                    </button>
                                    <button onclick="selectDifficulty('hard')" class="flex-1 py-2 rounded-lg font-bold ${state.difficulty === 'hard' ? 'bg-red-600' : 'bg-gray-700 hover:bg-gray-600'}">
                                        Hard (2 bombs)
                                    </button>
                                </div>
                            </div>
                            <div>
                                <label class="block text-sm text-gray-400 mb-2">Bet Amount</label>
                                <input type="number" id="towers-bet" value="${state.bet}" min="100" step="100"
                                    class="w-full px-4 py-2 bg-gray-900 border border-gray-700 rounded-lg text-white">
                            </div>
                            <button onclick="startTowers()" class="w-full px-4 py-3 bg-purple-600 hover:bg-purple-700 rounded-lg font-semibold">
                                Start Game - ${(state.bet / 100).toFixed(2)}
                            </button>
                        </div>
                    </div>
                `;
            }

            const getTileState = (row, col) => {
                const tile = state.revealed.find(r => r.row === row && r.col === col);
                if (tile) return tile.bomb ? 'bomb' : 'safe';
                return 'hidden';
            };

            return `
                <div class="bg-gray-800 rounded-lg border border-gray-700 p-6">
                    <h2 class="text-3xl font-bold mb-6 text-center">üè¢ Towers</h2>
                    <div class="space-y-4">
                        <div class="flex justify-between items-center p-4 bg-gray-900 rounded-lg">
                            <div>
                                <div class="text-sm text-gray-400">Row ${state.currentRow + 1}/8</div>
                                <div class="text-2xl font-bold text-green-400">${state.multiplier.toFixed(2)}x</div>
                            </div>
                            <div>
                                <div class="text-sm text-gray-400">Potential Win</div>
                                <div class="text-2xl font-bold">${((state.bet * state.multiplier) / 100).toFixed(2)}</div>
                            </div>
                        </div>
                        <div class="space-y-2">
                            ${Array(8).fill(0).map((_, row) => `
                                <div class="flex gap-2">
                                    ${Array(3).fill(0).map((_, col) => {
                                        const tileState = getTileState(7 - row, col);
                                        return `
                                            <button onclick="pickTower(${7 - row}, ${col})" 
                                                ${7 - row !== state.currentRow || state.gameOver ? 'disabled' : ''}
                                                class="flex-1 h-16 rounded-lg text-2xl font-bold transition-all ${
                                                    tileState === 'safe' ? 'bg-green-500 text-white' :
                                                    tileState === 'bomb' ? 'bg-red-500 text-white' :
                                                    7 - row === state.currentRow ? 'bg-gray-700 hover:bg-gray-600' :
                                                    'bg-gray-800'
                                                } disabled:opacity-50">
                                                ${tileState === 'safe' ? 'üíé' : tileState === 'bomb' ? 'üí£' : '?'}
                                            </button>
                                        `;
                                    }).join('')}
                                </div>
                            `).join('')}
                        </div>
                        ${!state.gameOver && state.currentRow > 0 ? `
                            <button onclick="cashoutTowers()" class="w-full px-4 py-3 bg-green-600 hover:bg-green-700 rounded-lg font-semibold">
                                Cashout ${((state.bet * state.multiplier) / 100).toFixed(2)}
                            </button>
                        ` : ''}
                        ${state.gameOver ? `
                            <button onclick="resetTowers()" class="w-full px-4 py-3 bg-purple-600 hover:bg-purple-700 rounded-lg font-semibold">
                                New Game
                            </button>
                        ` : ''}
                    </div>
                </div>
            `;
        }

        function renderPlinko() {
            const state = gameStates.plinko;
            const multipliers = {
                high: [80, 20, 5, 2, 0.4, 0.2, 0.2, 0.2, 0.4, 2, 5, 20, 80],
                medium: [20, 8, 4, 2, 0.5, 0.3, 0.3, 0.3, 0.5, 2, 4, 8, 20],
                low: [8, 4, 2, 1.2, 1, 0.7, 0.7, 0.7, 1, 1.2, 2, 4, 8]
            };

            return `
                <div class="bg-gray-800 rounded-lg border border-gray-700 p-6">
                    <h2 class="text-3xl font-bold mb-6 text-center">üéØ Plinko</h2>
                    <div class="space-y-6">
                        ${state.result && !state.dropping ? `
                            <div class="p-4 rounded-lg text-center ${state.result.multiplier >= 1 ? 'bg-green-500/20' : 'bg-red-500/20'}">
                                <div class="text-2xl font-bold mb-2">Slot ${state.result.slot} - ${state.result.multiplier}x</div>
                                <div class="text-xl font-semibold ${state.result.multiplier >= 1 ? 'text-green-300' : 'text-red-300'}">
                                    ${state.result.winAmount > 0 ? `Won ${(state.result.winAmount / 100).toFixed(2)}!` : 'Try again!'}
                                </div>
                            </div>
                        ` : ''}
                        <div class="flex justify-center">
                            <div class="w-64 h-64 bg-gray-900 rounded-lg flex items-center justify-center text-6xl ${state.dropping ? 'animate-bounce' : ''}">
                                ${state.dropping ? '‚ö™' : state.result ? 'üéØ' : 'üé≤'}
                            </div>
                        </div>
                        <div class="grid grid-cols-13 gap-1 text-center text-xs">
                            ${multipliers[state.risk].map((mult, i) => `
                                <div class="py-1 rounded ${
                                    mult >= 10 ? 'bg-green-600' :
                                    mult >= 2 ? 'bg-yellow-600' :
                                    mult >= 1 ? 'bg-blue-600' :
                                    'bg-red-600'
                                } ${state.result && state.result.slot === i ? 'ring-2 ring-white' : ''}">
                                    ${mult}x
                                </div>
                            `).join('')}
                        </div>
                        <div>
                            <label class="block text-sm text-gray-400 mb-2">Risk Level</label>
                            <div class="flex gap-2">
                                <button onclick="selectRisk('low')" class="flex-1 py-2 rounded-lg font-bold ${state.risk === 'low' ? 'bg-green-600' : 'bg-gray-700 hover:bg-gray-600'}">
                                    Low
                                </button>
                                <button onclick="selectRisk('medium')" class="flex-1 py-2 rounded-lg font-bold ${state.risk === 'medium' ? 'bg-yellow-600' : 'bg-gray-700 hover:bg-gray-600'}">
                                    Medium
                                </button>
                                <button onclick="selectRisk('high')" class="flex-1 py-2 rounded-lg font-bold ${state.risk === 'high' ? 'bg-red-600' : 'bg-gray-700 hover:bg-gray-600'}">
                                    High
                                </button>
                            </div>
                        </div>
                        <div>
                            <label class="block text-sm text-gray-400 mb-2">Bet Amount</label>
                            <input type="number" id="plinko-bet" value="${state.bet}" min="100" step="100"
                                class="w-full px-4 py-2 bg-gray-900 border border-gray-700 rounded-lg text-white">
                        </div>
                        <button onclick="dropPlinko()" ${state.loading ? 'disabled' : ''} class="w-full px-4 py-3 bg-purple-600 hover:bg-purple-700 rounded-lg font-semibold disabled:opacity-50">
                            Drop Ball - ${(state.bet / 100).toFixed(2)}
                        </button>
                    </div>
                </div>
            `;
        }

        function renderHiLo() {
            const state = gameStates.hilo;

            if (!state.gameActive) {
                return `
                    <div class="bg-gray-800 rounded-lg border border-gray-700 p-6">
                        <h2 class="text-3xl font-bold mb-6 text-center">üìä Hi-Lo</h2>
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm text-gray-400 mb-2">Bet Amount</label>
                                <input type="number" id="hilo-bet" value="${state.bet}" min="100" step="100"
                                    class="w-full px-4 py-2 bg-gray-900 border border-gray-700 rounded-lg text-white">
                            </div>
                            <button onclick="startHiLo()" class="w-full px-4 py-3 bg-purple-600 hover:bg-purple-700 rounded-lg font-semibold">
                                Start Game - ${(state.bet / 100).toFixed(2)}
                            </button>
                        </div>
                    </div>
                `;
            }

            return `
                <div class="bg-gray-800 rounded-lg border border-gray-700 p-6">
                    <h2 class="text-3xl font-bold mb-6 text-center">üìä Hi-Lo</h2>
                    <div class="space-y-6">
                        <div class="flex justify-between items-center p-4 bg-gray-900 rounded-lg">
                            <div>
                                <div class="text-sm text-gray-400">Multiplier</div>
                                <div class="text-2xl font-bold text-green-400">${state.multiplier.toFixed(2)}x</div>
                            </div>
                            <div>
                                <div class="text-sm text-gray-400">Potential Win</div>
                                <div class="text-2xl font-bold">${((state.bet * state.multiplier) / 100).toFixed(2)}</div>
                            </div>
                        </div>
                        <div class="flex justify-center gap-4">
                            ${state.currentCard ? renderCard(state.currentCard) : ''}
                            ${state.nextCard ? `<div class="animate-pulse">${renderCard(state.nextCard)}</div>` : ''}
                        </div>
                        ${!state.gameOver && !state.nextCard ? `
                            <div class="flex gap-2">
                                <button onclick="guessHiLo('higher')" class="flex-1 px-4 py-3 bg-purple-600 hover:bg-purple-700 rounded-lg font-semibold">
                                    ‚¨ÜÔ∏è Higher
                                </button>
                                <button onclick="guessHiLo('lower')" class="flex-1 px-4 py-3 bg-purple-600 hover:bg-purple-700 rounded-lg font-semibold">
                                    ‚¨áÔ∏è Lower
                                </button>
                            </div>
                            ${state.multiplier > 1 ? `
                                <button onclick="cashoutHiLo()" class="w-full px-4 py-3 bg-green-600 hover:bg-green-700 rounded-lg font-semibold">
                                    Cashout ${((state.bet * state.multiplier) / 100).toFixed(2)}
                                </button>
                            ` : ''}
                        ` : ''}
                        ${state.gameOver ? `
                            <button onclick="resetHiLo()" class="w-full px-4 py-3 bg-purple-600 hover:bg-purple-700 rounded-lg font-semibold">
                                New Game
                            </button>
                        ` : ''}
                    </div>
                </div>
            `;
        }

        // Game Actions
        async function dealBlackjack() {
            const bet = parseInt(document.getElementById('bj-bet').value);
            gameStates.blackjack.bet = bet;
            gameStates.blackjack.loading = true;

            try {
                const res = await fetch(`${API_URL}/game/blackjack/deal`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ username: currentUser.username, bet, isDemo })
                });
                const data = await res.json();
                gameStates.blackjack.gameState = data;
                if (data.balance !== undefined) updateBalance(data.balance);
            } catch (err) {
                alert('Error: ' + err.message);
            }
            gameStates.blackjack.loading = false;
            renderMainApp();
        }

        async function hitBlackjack() {
            try {
                const res = await fetch(`${API_URL}/game/blackjack/hit`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ username: currentUser.username })
                });
                const data = await res.json();
                gameStates.blackjack.gameState = { ...gameStates.blackjack.gameState, ...data };
                renderMainApp();
            } catch (err) {
                alert('Error: ' + err.message);
            }
        }

        async function standBlackjack() {
            try {
                const res = await fetch(`${API_URL}/game/blackjack/stand`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ username: currentUser.username })
                });
                const data = await res.json();
                gameStates.blackjack.gameState = { ...gameStates.blackjack.gameState, ...data };
                if (data.balance !== undefined) updateBalance(data.balance);
                renderMainApp();
            } catch (err) {
                alert('Error: ' + err.message);
            }
        }

        async function playPoker() {
            const bet = parseInt(document.getElementById('poker-bet').value);
            gameStates.poker.bet = bet;
            gameStates.poker.loading = true;

            try {
                const res = await fetch(`${API_URL}/game/poker/deal`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ username: currentUser.username, bet, isDemo })
                });
                const data = await res.json();
                gameStates.poker.result = data;
                if (data.balance !== undefined) updateBalance(data.balance);
            } catch (err) {
                alert('Error: ' + err.message);
            }
            gameStates.poker.loading = false;
            renderMainApp();
        }

        async function startMines() {
            const bet = parseInt(document.getElementById('mines-bet').value);
            const mineCount = parseInt(document.getElementById('mines-count').value);
            gameStates.mines.bet = bet;
            gameStates.mines.mineCount = mineCount;

            try {
                const res = await fetch(`${API_URL}/game/mines/start`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ username: currentUser.username, bet, mineCount, isDemo })
                });
                const data = await res.json();
                if (res.ok) {
                    gameStates.mines.gameActive = true;
                    gameStates.mines.revealed = [];
                    gameStates.mines.multiplier = 1.0;
                    gameStates.mines.gameOver = false;
                    if (data.balance !== undefined) updateBalance(data.balance);
                    renderMainApp();
                }
            } catch (err) {
                alert('Error: ' + err.message);
            }
        }

        async function revealMine(index) {
            if (gameStates.mines.revealed.includes(index) || gameStates.mines.gameOver) return;

            try {
                const res = await fetch(`${API_URL}/game/mines/reveal`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ username: currentUser.username, index })
                });
                const data = await res.json();

                if (data.result.hit === 'mine') {
                    gameStates.mines.revealed.push(index);
                    gameStates.mines.gameOver = true;
                    gameStates.mines.gameActive = false;
                } else {
                    gameStates.mines.revealed.push(index);
                    gameStates.mines.multiplier = data.result.multiplier;
                }
                renderMainApp();
            } catch (err) {
                alert('Error: ' + err.message);
            }
        }

        async function cashoutMines() {
            try {
                const res = await fetch(`${API_URL}/game/mines/cashout`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ username: currentUser.username })
                });
                const data = await res.json();
                if (data.balance !== undefined) updateBalance(data.balance);
                alert(`Cashed out ${(data.winAmount / 100).toFixed(2)}!`);
                gameStates.mines.gameActive = false;
                gameStates.mines.gameOver = true;
                renderMainApp();
            } catch (err) {
                alert('Error: ' + err.message);
            }
        }

        function resetMines() {
            gameStates.mines.gameActive = false;
            gameStates.mines.revealed = [];
            renderMainApp();
        }

        async function flipCoin() {
            const bet = parseInt(document.getElementById('coin-bet').value);
            gameStates.coinflip.bet = bet;
            gameStates.coinflip.loading = true;
            gameStates.coinflip.flipping = true;
            gameStates.coinflip.result = null;
            renderMainApp();

            setTimeout(async () => {
                try {
                    const res = await fetch(`${API_URL}/game/coinflip`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ 
                            username: currentUser.username, 
                            bet, 
                            choice: gameStates.coinflip.choice, 
                            isDemo 
                        })
                    });
                    const data = await res.json();
                    gameStates.coinflip.result = data;
                    if (data.balance !== undefined) updateBalance(data.balance);
                    gameStates.coinflip.flipping = false;
                } catch (err) {
                    alert('Error: ' + err.message);
                    gameStates.coinflip.flipping = false;
                }
                gameStates.coinflip.loading = false;
                renderMainApp();
            }, 1500);
        }

        function selectCoinSide(side) {
            gameStates.coinflip.choice = side;
            renderMainApp();
        }

        async function spinRoulette() {
            const bet = parseInt(document.getElementById('roulette-bet').value);
            gameStates.roulette.bet = bet;
            gameStates.roulette.loading = true;
            gameStates.roulette.spinning = true;
            gameStates.roulette.result = null;
            renderMainApp();

            setTimeout(async () => {
                try {
                    const res = await fetch(`${API_URL}/game/roulette`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ 
                            username: currentUser.username, 
                            bet, 
                            betType: gameStates.roulette.betType, 
                            isDemo 
                        })
                    });
                    const data = await res.json();
                    gameStates.roulette.result = data;
                    if (data.balance !== undefined) updateBalance(data.balance);
                    gameStates.roulette.spinning = false;
                } catch (err) {
                    alert('Error: ' + err.message);
                    gameStates.roulette.spinning = false;
                }
                gameStates.roulette.loading = false;
                renderMainApp();
            }, 2000);
        }

        function selectBetType(type) {
            gameStates.roulette.betType = type;
            renderMainApp();
        }

        async function startTowers() {
            const bet = parseInt(document.getElementById('towers-bet').value);
            gameStates.towers.bet = bet;

            try {
                const res = await fetch(`${API_URL}/game/towers/start`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        username: currentUser.username, 
                        bet, 
                        difficulty: gameStates.towers.difficulty, 
                        isDemo 
                    })
                });
                const data = await res.json();
                if (res.ok) {
                    gameStates.towers.gameActive = true;
                    gameStates.towers.currentRow = 0;
                    gameStates.towers.revealed = [];
                    gameStates.towers.gameOver = false;
                    gameStates.towers.multiplier = 1.0;
                    if (data.balance !== undefined) updateBalance(data.balance);
                    renderMainApp();
                }
            } catch (err) {
                alert('Error: ' + err.message);
            }
        }

        async function pickTower(row, col) {
            if (row !== gameStates.towers.currentRow || gameStates.towers.gameOver) return;

            try {
                const res = await fetch(`${API_URL}/game/towers/pick`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ username: currentUser.username, row, col })
                });
                const data = await res.json();

                if (data.isBomb) {
                    gameStates.towers.revealed.push({ row, col, bomb: true });
                    gameStates.towers.gameOver = true;
                    gameStates.towers.gameActive = false;
                } else {
                    gameStates.towers.revealed.push({ row, col, bomb: false });
                    if (data.gameOver) {
                        gameStates.towers.gameOver = true;
                        gameStates.towers.gameActive = false;
                        if (data.balance !== undefined) updateBalance(data.balance);
                        alert(`You won ${(data.winAmount / 100).toFixed(2)}!`);
                    } else {
                        gameStates.towers.currentRow = data.currentRow;
                        gameStates.towers.multiplier = data.multiplier;
                    }
                }
                renderMainApp();
            } catch (err) {
                alert('Error: ' + err.message);
            }
        }

        async function cashoutTowers() {
            try {
                const res = await fetch(`${API_URL}/game/towers/cashout`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ username: currentUser.username })
                });
                const data = await res.json();
                if (data.balance !== undefined) updateBalance(data.balance);
                alert(`Cashed out ${(data.winAmount / 100).toFixed(2)}!`);
                gameStates.towers.gameActive = false;
                gameStates.towers.gameOver = true;
                renderMainApp();
            } catch (err) {
                alert('Error: ' + err.message);
            }
        }

        function selectDifficulty(diff) {
            gameStates.towers.difficulty = diff;
            renderMainApp();
        }

        function resetTowers() {
            gameStates.towers.gameActive = false;
            gameStates.towers.revealed = [];
            renderMainApp();
        }

        async function dropPlinko() {
            const bet = parseInt(document.getElementById('plinko-bet').value);
            gameStates.plinko.bet = bet;
            gameStates.plinko.loading = true;
            gameStates.plinko.dropping = true;
            gameStates.plinko.result = null;
            renderMainApp();

            setTimeout(async () => {
                try {
                    const res = await fetch(`${API_URL}/game/plinko`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ 
                            username: currentUser.username, 
                            bet, 
                            risk: gameStates.plinko.risk, 
                            isDemo 
                        })
                    });
                    const data = await res.json();
                    gameStates.plinko.result = data;
                    if (data.balance !== undefined) updateBalance(data.balance);
                    gameStates.plinko.dropping = false;
                } catch (err) {
                    alert('Error: ' + err.message);
                    gameStates.plinko.dropping = false;
                }
                gameStates.plinko.loading = false;
                renderMainApp();
            }, 1500);
        }

        function selectRisk(risk) {
            gameStates.plinko.risk = risk;
            renderMainApp();
        }

        async function startHiLo() {
            const bet = parseInt(document.getElementById('hilo-bet').value);
            gameStates.hilo.bet = bet;

            try {
                const res = await fetch(`${API_URL}/game/hilo/start`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ username: currentUser.username, bet, isDemo })
                });
                const data = await res.json();
                gameStates.hilo.currentCard = data.currentCard;
                gameStates.hilo.gameActive = true;
                gameStates.hilo.multiplier = 1.0;
                gameStates.hilo.gameOver = false;
                gameStates.hilo.nextCard = null;
                if (data.balance !== undefined) updateBalance(data.balance);
                renderMainApp();
            } catch (err) {
                alert('Error: ' + err.message);
            }
        }

        async function guessHiLo(direction) {
            try {
                const res = await fetch(`${API_URL}/game/hilo/guess`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ username: currentUser.username, direction })
                });
                const data = await res.json();
                gameStates.hilo.nextCard = data.nextCard;

                if (data.gameOver) {
                    gameStates.hilo.gameOver = true;
                    gameStates.hilo.gameActive = false;
                    if (data.balance !== undefined) updateBalance(data.balance);
                    if (data.won) {
                        setTimeout(() => alert(`You won ${(data.winAmount / 100).toFixed(2)}!`), 500);
                    }
                } else {
                    gameStates.hilo.multiplier = data.multiplier;
                    setTimeout(() => {
                        gameStates.hilo.currentCard = data.nextCard;
                        gameStates.hilo.nextCard = null;
                        renderMainApp();
                    }, 1000);
                }
                renderMainApp();
            } catch (err) {
                alert('Error: ' + err.message);
            }
        }

        async function cashoutHiLo() {
            try {
                const res = await fetch(`${API_URL}/game/hilo/cashout`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ username: currentUser.username })
                });
                const data = await res.json();
                if (data.balance !== undefined) updateBalance(data.balance);
                alert(`Cashed out ${(data.winAmount / 100).toFixed(2)}!`);
                gameStates.hilo.gameActive = false;
                gameStates.hilo.gameOver = true;
                renderMainApp();
            } catch (err) {
                alert('Error: ' + err.message);
            }
        }

        function resetHiLo() {
            gameStates.hilo.gameActive = false;
            gameStates.hilo.currentCard = null;
            renderMainApp();
        }

        // Utility Functions
        function updateBalance(newBalance) {
            if (isDemo) {
                currentUser.freeBalance = newBalance;
            } else {
                currentUser.balance = newBalance;
            }
        }

        function toggleDemo() {
            isDemo = !isDemo;
            renderMainApp();
        }

        function selectGame(gameId) {
            currentGame = gameId;
            renderMainApp();
        }

        function backToGames() {
            currentGame = null;
            renderMainApp();
        }

        function logout() {
            currentUser = null;
            currentGame = null;
            isDemo = false;
            renderAuthScreen();
        }

        function showBugReport() {
            document.getElementById('bug-modal').classList.remove('hidden');
        }

        function closeBugReport() {
            document.getElementById('bug-modal').classList.add('hidden');
        }

        async function submitBugReport() {
            const game = document.getElementById('bug-game').value;
            const description = document.getElementById('bug-description').value;

            if (!game || !description) {
                alert('Please select a game and enter a description');
                return;
            }

            try {
                await fetch(`${API_URL}/api/bug-report`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        username: currentUser.username, 
                        game, 
                        description 
                    })
                });
                closeBugReport();
                document.getElementById('bug-game').value = '';
                document.getElementById('bug-description').value = '';
                alert('Bug report submitted! You may receive $0.25 if accepted.');
            } catch (err) {
                alert('Failed to submit bug report');
            }
        }

        // Initialize app
        renderAuthScreen();
    </script>
</body>
</html>
